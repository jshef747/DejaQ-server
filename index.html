<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DejaQ Normalization Test</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f0f2f5; color: #333; }
        .chat-container { max_width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        #log { height: 400px; overflow-y: scroll; border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; border-radius: 4px; }

        /* Message Styles */
        .message { margin-bottom: 10px; padding: 8px; border-radius: 4px; }
        .sent { background: #e3f2fd; text-align: right; }
        .received { background: #f1f8e9; }

        /* The Normalization Debug Info */
        .debug-info {
            font-size: 0.85em;
            color: #d32f2f;
            margin-top: 4px;
            font-family: monospace;
            background: #ffebee;
            padding: 2px 6px;
            border-radius: 4px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <h2>DejaQ Normalizer Test</h2>
        <div id="status">Status: Disconnected</div>

        <div id="log"></div>

        <div style="display: flex; gap: 10px;">
            <input type="text" id="msgInput" placeholder="Type a messy query (e.g., 'umm what is the wifi please')" style="flex-grow: 1; padding: 10px;">
            <button onclick="sendMessage()" style="padding: 10px 20px;">Send</button>
        </div>
    </div>

    <script>
        const ws = new WebSocket("ws://localhost:8000/ws/chat");

        ws.onopen = () => document.getElementById("status").innerText = "Status: Connected âœ…";

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);

            // Build the HTML for the response
            let html = `<strong>[System]:</strong> ${data.message}`;

            // IF we have a normalized version, show it!
            if (data.normalized_message) {
                html += `<br><span class="debug-info">Normalized to: "${data.normalized_message}"</span>`;
            }

            logHTML(html, "received");
        };

        function sendMessage() {
            const input = document.getElementById("msgInput");
            const text = input.value;

            const payload = {
                user_id: "test_user",
                department_id: "engineering",
                message: text
            };

            ws.send(JSON.stringify(payload));
            logHTML(`<strong>[Me]:</strong> ${text}`, "sent");
            input.value = "";
        }

        function logHTML(htmlContent, type) {
            const logDiv = document.getElementById("log");
            logDiv.innerHTML += `<div class="message ${type}">${htmlContent}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
    </script>
</body>
</html>